#! /bin/bash

hash parallel 2>/dev/null || {
    echo >&2 "Required command 'parallel' is not installed. Aborting."
    exit 1
}

hash git 2>/dev/null || {
    echo >&2 "Required command 'git' is not installed. Aborting."
    exit 1
}

function git_fetch() {
    local repo="${1%.git}"
    pushd "$repo"
    git fetch
    popd 2>&1 >/dev/null
}

export -f git_fetch

find . -type d -name '.git' -print0 |
    parallel -0 git_fetch "{}"
