#! /bin/bash

function check_exec() {
    for exe in $@; do
        hash "$exe" 2>/dev/null || {
            echo >&2 "Required command '$exe' is not installed. Aborting."
            exit 1
        }
    done
}
check_exec parallel git

function git_fetch() {
    local repo="${1%.git}"
    pushd "$repo"
    git fetch
    popd 2>&1 >/dev/null
}

export -f git_fetch

find . -type d -name '.git' -print0 |
    parallel -0 git_fetch "{}"
